{%- comment -%} Set variables {%- endcomment -%}
{%- liquid
  # Global image assigns
  assign image_aspect_ratio = section.settings.aspect_ratio
  assign aspect_ratio = section.settings.aspect_ratio | replace: '[', '|' | replace: ']', '|' | split: '|'
  assign aspect_ratio = aspect_ratio[1]

  capture image_class
    echo image_aspect_ratio
    echo ' object-cover w-full'
  endcapture

  # Image assign based on container width
  case section.settings.container_width
    when 'container--wide'
      assign image_sizes = '(min-width: 1024px) 25vw, (min-width: 480px) 50vw, 100vw'
      assign image_max_width = 1920
    else
      assign image_sizes = '(min-width: 1440px) 316px, (min-width: 1024px) 25vw, (min-width: 480px) 50vw, 100vw'
      assign image_max_width = 456
  endcase

  # Assign lazy loading
  assign lazy = section.settings.lazy | default: true

  # Container class
  assign container_class = 'featured-image-grid' | append: ' ' | append: section.settings.container_width
  if section.settings.color_scheme != blank
    assign container_class = container_class | append: ' container--background my-0 ' | append: section.settings.color_scheme
  endif

  # Container title
  assign container_title = section.settings.heading | escape

  # Title Class
  assign title_class = section.settings.heading_size | append: ' text-center'
-%}

{%- comment -%} Capture blocks {%- endcomment -%}
{%- capture blocks -%}
  {%- for block in section.blocks -%}
    {%- liquid
      # Capture the image with correct parameters.
      capture image_block
        render 'format-image', image_object: block.settings.image_src, alt: block.settings.image_src.alt, max_width: image_max_width, aspect_ratio: aspect_ratio, sizes: image_sizes, lazy: lazy, class: image_class
      endcapture

      # Get social icon
      if block.settings.show_social_icon
        assign icon = block.settings.icon | handleize
        assign icon_class = 'icon icon--' | append: icon
        if block.settings.icon_size != blank
          assign icon_class = icon_class | append: ' ' | append: block.settings.icon_size
        endif
        if block.settings.icon_shape != blank
          assign icon = icon | append: '_' | append: block.settings.icon_shape
        endif
      endif
    -%}

    {%- if block.settings.url != blank -%}
      <a href="{{ block.settings.url }}" class="featured-image group relative" title="{{ block.settings.seo_title | escape }}">
        {{- image_block -}}
        <div class="featured-image__overlay absolute inset-0 flex items-center justify-center bg-gray-50 opacity-0 transition-opacity group-hover:opacity-50"></div>
        {%- if block.settings.show_social_icon -%}
          <div class="absolute left-2/4 top-2/4 -translate-x-2/4 -translate-y-2/4 opacity-0 transition-all group-hover:opacity-100">
            {%- render 'icons-social', icon: icon, class: icon_class -%}
          </div>
        {%- endif -%}
      </a>
    {%- else -%}
      <div class="featured-image group relative">
        {{- image_block -}}
      </div>
    {%- endif -%}

  {%- endfor -%}

{%- endcapture -%}

{% comment %} Demo slides {% endcomment %}
{%- if blocks == blank -%}
  {%- capture blocks -%}
    {%- for i in (1..8) -%}
      <div class="featured-image group relative">
        <div class="block bg-gray-50 {{ section.settings.aspect_ratio }} w-full">
          {{- 'collection-1' | placeholder_svg_tag -}}
        </div>
        <div class="featured-image__overlay absolute inset-0 flex items-center justify-center bg-gray-50 opacity-0 transition-opacity group-hover:opacity-75"></div>
        <div class="absolute left-2/4 top-2/4 -translate-x-2/4 -translate-y-2/4 opacity-0 transition-all group-hover:opacity-100">
          {%- render 'icons-social', icon: 'instagram', class: "w-6" -%}
        </div>
      </div>
    {%- endfor -%}
  {%- endcapture -%}
{%- endif -%}

{%- comment -%} Capture content {%- endcomment -%}
{%- capture content -%}
  <div class="grid grid-cols-1 gap-base sm:grid-cols-2 lg:grid-cols-4">
    {{- blocks -}}
  </div>
{%- endcapture -%}

{%- comment -%} Container footer {%- endcomment -%}
{%- capture container_footer -%}
  {%- if section.settings.button_text != blank -%}
    <a
      {% if section.settings.button_url != blank -%}
        href="{{ section.settings.button_url }}"
      {% else %}
        disabled
      {% endif %}
      class="button {{ section.settings.button_size }} {{ section.settings.button_color_scheme }}"
    >
      {{- section.settings.button_text -}}
    </a>
  {%- endif -%}
{%- endcapture -%}

{%- comment -%} Render the content {%- endcomment -%}
{%- render 'format-container',
  class: container_class,
  title: container_title,
  title_class: title_class,
  title_tag: section.settings.heading_element,
  content: content,
  footer_class: 'text-center',
  footer_content: container_footer
-%}

{% schema %}
  {
    "name": "Featured image grid",
    "tag": "section",
    "settings": [
      {
        "type": "header",
        "content": "Appearance settings"
      },
      {
        "type": "select",
        "id": "container_width",
        "label": "Section content width",
        "default": "",
        "options": [
          {
            "value": "",
            "label": "Default"
          },
          {
            "value": "container--wide",
            "label": "Wide"
          }
        ]
      },
      {
        "type": "select",
        "id": "color_scheme",
        "default": "",
        "label": "Color scheme",
        "options": [
          {
            "value": "",
            "label": "Default"
          },
          {
            "value": "color-scheme color-scheme--primary",
            "label": "Primary",
            "group": "Theme"
          },
          {
            "value": "color-scheme color-scheme--secondary",
            "label": "Secondary",
            "group": "Theme"
          },
          {
            "value": "color-scheme color-scheme--accent",
            "label": "Accent",
            "group": "Theme"
          },
          {
            "value": "color-scheme color-scheme--white",
            "label": "White",
            "group": "Standard"
          },
          {
            "value": "color-scheme color-scheme--gray",
            "label": "Gray",
            "group": "Standard"
          },
          {
            "value": "color-scheme color-scheme--black",
            "label": "Black",
            "group": "Standard"
          }
        ]
      },
      {
        "type": "header",
        "content": "Content settings"
      },
      {
        "type": "checkbox",
        "id": "lazy",
        "label": "Lazyload",
        "default": true,
        "info": "For page speed, disable if the image is directly visible on mobile and desktop"
      },
      {
        "type": "select",
        "id": "aspect_ratio",
        "label": "Aspect ratio",
        "default": "aspect-[1/1]",
        "options": [
          {
            "value": "aspect-[16/9]",
            "label": "16x9"
          },
          {
            "value": "aspect-[4/3]",
            "label": "4x3"
          },
          {
            "value": "aspect-[1/1]",
            "label": "1x1"
          },
          {
            "value": "aspect-[3/4]",
            "label": "3x4"
          },
          {
            "value": "aspect-[9/16]",
            "label": "9x16"
          }
        ]
      },

      {
        "type": "header",
        "content": "Header settings"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Featured image grid"
      },
      {
        "type": "select",
        "id": "heading_element",
        "label": "Heading element",
        "default": "h2",
        "info": "Change the element of the heading for SEO.",
        "options": [
          {
            "value": "h1",
            "label": "H1"
          },
          {
            "value": "h2",
            "label": "H2"
          },
          {
            "value": "h3",
            "label": "H3"
          },
          {
            "value": "h4",
            "label": "H4"
          },
          {
            "value": "h5",
            "label": "H5"
          },
          {
            "value": "h6",
            "label": "H6"
          }
        ]
      },
      {
        "type": "select",
        "id": "heading_size",
        "label": "Heading size",
        "default": "h4",
        "info": "Change the style of the heading to only influence the look and feel.",
        "options": [
          {
            "value": "h1",
            "label": "H1"
          },
          {
            "value": "h2",
            "label": "H2"
          },
          {
            "value": "h3",
            "label": "H3"
          },
          {
            "value": "h4",
            "label": "H4"
          },
          {
            "value": "h5",
            "label": "H5"
          },
          {
            "value": "h6",
            "label": "H6"
          }
        ]
      },
      {
        "type": "header",
        "content": "Button"
      },
      {
        "type": "text",
        "id": "button_text",
        "label": "Text"
      },
      {
        "type": "url",
        "id": "button_url",
        "label": "Url",
        "info": "Optional. Overwrite the button link."
      },
      {
        "type": "select",
        "id": "button_color_scheme",
        "default": "",
        "label": "Color scheme",
        "options": [
          {
            "value": "",
            "label": "Default"
          },
          {
            "value": "button--primary",
            "label": "Primary"
          },
          {
            "value": "button--secondary",
            "label": "Secondary"
          },
          {
            "value": "button--outline",
            "label": "Outline"
          },
          {
            "value": "button--link",
            "label": "Link"
          }
        ]
      },
      {
        "type": "select",
        "id": "button_size",
        "default": "button--md",
        "label": "Size",
        "options": [
          {
            "value": "button--sm",
            "label": "Small"
          },
          {
            "value": "button--md",
            "label": "Medium"
          },
          {
            "value": "button--lg",
            "label": "Large"
          },
          {
            "value": "button--xl",
            "label": "Extra large"
          }
        ]
      }
    ],
    "blocks": [
      {
        "type": "image",
        "name": "Image",
        "settings": [
          {
            "type": "image_picker",
            "id": "image_src",
            "label": "Image",
            "info": "The best size is the max width @2x."
          },
          {
            "type": "url",
            "id": "url",
            "label": "Link"
          },
          {
            "type": "text",
            "id": "seo_title",
            "label": "Seo title for link"
          },
          {
            "type": "header",
            "content": "Icon settings"
          },
          {
            "type": "checkbox",
            "id": "show_social_icon",
            "label": "Social icon on hover",
            "info": "Enable if you like to show a social icon on hover",
            "default": true
          },
          {
            "type": "select",
            "id": "icon",
            "label": "Social platform icon",
            "default": "instagram",
            "options": [
              {
                "value": "facebook",
                "label": "Facebook"
              },
              {
                "value": "instagram",
                "label": "Instagram"
              },
              {
                "value": "pinterest",
                "label": "Pinterest"
              }
            ]
          },
          {
            "type": "select",
            "id": "icon_shape",
            "label": "Icon shape",
            "default": "",
            "options": [
              {
                "value": "",
                "label": "Regular"
              },
              {
                "value": "round",
                "label": "Round"
              }
            ]
          },
          {
            "type": "select",
            "id": "icon_size",
            "label": "Icon size",
            "default": "w-12",
            "options": [
              {
                "value": "w-4",
                "label": "Small"
              },
              {
                "value": "w-6",
                "label": "Medium"
              },
              {
                "value": "w-8",
                "label": "Large"
              },
              {
                "value": "w-12",
                "label": "Extra large"
              }
            ]
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Featured image grid"
      }
    ]
  }
{% endschema %}
